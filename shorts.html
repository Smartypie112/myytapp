<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouTube Search + Shorts</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f9f9f9;
    color: #0f0f0f;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Back button centered on page */
  #backBtn {
    margin: 50px 0;
    padding: 15px 30px;
    border: none;
    border-radius: 8px;
    background: #3d9eff;
    color: white;
    font-weight: bold;
    font-size: 18px;
    cursor: pointer;
  }

  header {
    width: 100%;
    display: flex;
    align-items: center;
    padding: 10px 20px;
    background: white;
    box-shadow: 0 1px 5px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
    gap: 10px;
  }
  #search-bar {
    flex: 1;
    display: flex;
    align-items: center;
  }
  #query {
    flex: 1;
    padding: 10px;
    font-size: 16px;
    border: 1px solid #ddd;
    border-radius: 20px 0 0 20px;
    outline: none;
  }
  #search-button {
    padding: 10px 20px;
    border: 1px solid #ddd;
    border-left: none;
    background: #f8f8f8;
    border-radius: 0 20px 20px 0;
    cursor: pointer;
  }

  #results {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px;
    padding: 20px;
    width: 100%;
    max-width: 1200px;
  }

  .video-card {
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.2s ease;
    cursor: pointer;
  }
  .video-card:hover {
    transform: scale(1.02);
  }
  .thumbnail {
    width: 100%;
    height: 180px;
    object-fit: cover;
  }
  .video-info {
    padding: 10px;
  }
  .video-title {
    font-size: 16px;
    font-weight: bold;
    margin: 0 0 8px 0;
    color: #0f0f0f;
  }
  .channel-name {
    font-size: 14px;
    color: #606060;
  }

  /* Shorts overlay */
  #shortsViewer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: black;
    display: none;
    z-index: 2000;
  }
  .shorts-container {
    height: 100%;
    overflow-y: scroll;
    scroll-snap-type: y mandatory;
  }
  .short {
    position: relative;
    width: 100%;
    height: 100vh;
    scroll-snap-align: start;
    display: flex;
    justify-content: center;
    align-items: center;
    background: black;
    scroll-snap-stop: always;
  }
  iframe {
    width: 100%;
    height: 100%;
    border: none;
  }
  #closeBtn {
    position: absolute;
    top: 15px;
    left: 15px;
    background: rgba(255,255,255,0.2);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    z-index: 20;
  }
</style>
</head>
<body>


<header>
  <div id="search-bar">
    <input type="text" id="query" placeholder="Search" />
    <button id="search-button" onclick="searchVideos()">üîç</button>
  </div>
</header>
<!-- Centered Back button -->
<button id="backBtn" onclick="window.history.back()">‚Üê Back</button>

<div id="results"></div>

<!-- Shorts Viewer Overlay -->
<div id="shortsViewer">
  <button id="closeBtn">‚úñ</button>
  <div class="shorts-container" id="shortsContainer"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const API_KEY = "AIzaSyDDbyrMDQoMkvDzRz72p9JM_C09Ee8lX9M"; // Replace with your key
let currentVideos = [];
let players = [];

async function searchVideos() {
  const query = document.getElementById("query").value.trim();
  if (!query) return alert("Please enter a search term");
document.getElementById("backBtn").style.display = "none";
  const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=20&q=${encodeURIComponent(query)}&key=${API_KEY}`;

  try {
    const response = await fetch(url);
    const data = await response.json();

    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    if (data.items) {
      currentVideos = data.items.map(item => item.id.videoId);

      data.items.forEach((item, index) => {
        const videoId = item.id.videoId;
        const title = item.snippet.title;
        const channel = item.snippet.channelTitle;
        const thumbnail = item.snippet.thumbnails.high.url;

        const videoCard = document.createElement("div");
        videoCard.className = "video-card";
        videoCard.innerHTML = `
          <img class="thumbnail" src="${thumbnail}" alt="${title}">
          <div class="video-info">
            <p class="video-title">${title}</p>
            <p class="channel-name">${channel}</p>
          </div>
        `;
        videoCard.onclick = () => openShorts(index);
        resultsDiv.appendChild(videoCard);
      });
    } else {
      resultsDiv.innerHTML = "<p>No results found.</p>";
    }
  } catch (error) {
    console.error("Error fetching videos:", error);
  }
}

function openShorts(startIndex) {
  const viewer = document.getElementById("shortsViewer");
  const container = document.getElementById("shortsContainer");
  container.innerHTML = "";
  players = [];

  currentVideos.forEach((videoId, index) => {
    const short = document.createElement("div");
    short.className = "short";
    short.innerHTML = `<div id="player${index}" class="player"></div>`;
    container.appendChild(short);
  });

  viewer.style.display = "block";

  setTimeout(() => {
    container.scrollTo({
      top: startIndex * window.innerHeight,
      behavior: "instant"
    });
  }, 200);

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const index = [...container.children].indexOf(entry.target);
      if (index < 0) return;

      if (entry.isIntersecting) {
        if (!players[index]) {
          players[index] = new YT.Player(`player${index}`, {
            videoId: currentVideos[index],
            playerVars: { autoplay: 0, controls: 0, mute: 0, rel: 0, modestbranding: 1, playsinline: 1 }
          });
        } else {
          players[index].playVideo();
        }
      } else {
        if (players[index]) try { players[index].pauseVideo(); } catch(e){}
      }
    });
  }, { threshold: 0.6 });

  document.querySelectorAll(".short").forEach(el => observer.observe(el));

  // Unmute all videos when user clicks once
  document.getElementById("shortsViewer").addEventListener("click", () => {
    players.forEach(p => { try { p.unMute(); p.setVolume(100); } catch(e){} });
  }, { once: true });
}

document.getElementById("closeBtn").onclick = () => {
  document.getElementById("shortsViewer").style.display = "none";
  players.forEach(p => { try { p.stopVideo(); } catch {} });
};
</script>
</body>
</html>